---
font: Lato
fontsize: 10pt
geometry: left=1in,right=1in,top=0.35in,bottom=0.6in
header-includes: null
output:
  html_document:
    df_print: paged
sansfont: Lato
urlcolor: null
---


```{r rmarkdown-setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(dev = "cairo_pdf")
options(knitr.kable.NA = "")
options(kableExtra.latex.load_packages = FALSE)

#setwd("GitHub/covid19-indicators")

library(tidyverse)
library(knitr)
library(kableExtra)
library(ggplot2)
library(plotly)
library(scales)
library(glue)
```


# LA's COVID-19 Reopening Indicators

This report contains information about how LA County and the City of LA performed yesterday, on a number of key COVID-19 indicators related to the speed at which opening up can occur. Taken together, performing well against the benchmarks provide confidence in moving through each phase of reopening.

**LA is certainly an epicenter**. LA reached [5,000 deaths](https://www.latimes.com/california/story/2020-08-11/13000-more-coronavirus-cases-california-test-results-backlog) by mid-August, the 3rd highest US county by deaths, after Queens and Kings Counties in New York.

### Cases and Deaths by Neighborhood



```{r echo=FALSE,  fig.width =7 , fig.height =2}
# arbitrary data to demonstrate a table
#today_date = sys.Date()
data <- read.csv(file = "data/la-county-neighborhood-time-series.csv", 
                 header = TRUE, sep = ",", row.names(FALSE))

data$date <- as.Date(factor(data$date))
#sapply(data, class)

NEIGHBORHOOD = "Hacienda Heights"

neighborhood_df <- filter(data, Region == NEIGHBORHOOD) %>%
  select(c("Region", "date", "cases", "deaths"))

past_week <- tail(neighborhood_df, 7)


# Print table of past week
kable(past_week, format.args = list(big.mark = ",")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                position = "float_left") %>%
  column_spec(1, bold = T, border_right = T)
```


```{r echo=FALSE}
CASE_TITLE = "{NEIGHBORHOOD}: Total Cases"
DEATH_TITLE = "{NEIGHBORHOOD}: Total Deaths"

# Add new_cases and new_deaths columns
neighborhood_df <- neighborhood_df %>% 
  mutate(new_cases = cases - lag(cases)) %>%
  mutate(new_deaths = deaths - lag(deaths))

  
chart_aesthetics <- function(chart) {
  chart <- chart +
        theme(
          plot.title = element_text(family = "Arial", face = "bold", color = "gray", 
                                    size = 14, hjust=0.5), 
          axis.title.x = element_text(size = 10), 
          axis.title.y = element_text(size=10), 
          axis.text.x = element_text(size=9)
          ) +
        scale_x_date(labels = date_format("%m-%d"), breaks = date_breaks("2 weeks")
        ) 
  
  return(chart)
}
```
This chart shows total cases over time.

```{r echo=FALSE,  fig.width =7 , fig.height =5}
# Cases chart
cases_chart <- ggplot() + 
      geom_line(
        aes(y = cases, x = date), data = neighborhood_df, color = "blue") +
        xlab("date") + ylab("# cumulative cases") + 
        ggtitle(glue(CASE_TITLE))

cases_chart <- chart_aesthetics(cases_chart) %>% ggplotly()
cases_chart
```

This chart shows total deaths over time (deaths data was collected by neighborhoods starting mid-July).
```{r echo=FALSE, fig.width =7, fig.height =5}
# Deaths chart
deaths_chart <- ggplot() + 
      geom_line(
        aes(y = deaths, x = date), data = neighborhood_df, color = "red") +
        xlab("date") + ylab("# cumulative deaths") + 
        ggtitle(glue(DEATH_TITLE))

deaths_chart <- chart_aesthetics(deaths_chart) %>% ggplotly()
deaths_chart
```